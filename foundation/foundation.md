> Linux的基础应用

# 一些基础操作

## 常用快捷键

- ctrl+alt+t可以唤出终端
- ctrl+alt+F1或者各种，可以进入命令模式
- **shell中无论几个空格，都会视作一个**
- **大小写区分的**
- 自己的家目录用~
- **ctrl+c可以中断在运行的程序**
- ctrl+d类似于退出

## 关机命令

```
shutdown [-krhc] [时间] [警告信息]
```

- 一般常用的就是-r重启，-h立即关机
- shutdown -c可以取消这个命令

# Linux的文件权限和目录配置

## 用户和用户组

- 文件拥有者
  - 顾名思义就好，这个文件所有者
- 用户组的概念
  - 就是组群，进行权限管理用的东西，一般各种组的权限是不一样的
  - **每个账号可以在多个组群，没关系的**
- 其他人的概念
  - 是个相对的概念，不再你的组群里面的人，相当于其他人

### Linux用户身份与用户组记录的文件

所有用户的信息都记录在**/etc/passwd**中，密码一般在**/etc/shadow**这个文件夹中，组名一般都在**/etc/group**中

## Linux的文件权限概念

> ​	linux的思想就是任何东西都是文件，所以对于文件和文件权限的理解非常重要

### Linux文件属性

使用ls命令查看文件可以看到类似下面这类列表

![1566095335867](D:\learning\LinuxLearning\foundation\TyporaImg\1566095335867.png)

- 第一栏就是权限，前面是d开头的，说明是目录，-说明是文件,|说明是链接文件，c代表串行端口设备
- rwx分别是读、写、执行的意思
- 第一组是文件所有者的权限，第二组是加入此用户组的权限，第三组是其他人的权限
- 数字表示连接数
- 文件所有者，和文件所有用户组在后面
- 4096这类数字是文件大小，单位是字节
- 后面就是文件修改的时间和文件名，文件名前面加.说明是隐藏文件

- 注意：**对于目录文件，r--是指能列出目录里面的文件列表，但是无法进入目录的，要想进入目录必须要r-x**

### 修改文件属性和权限

#### chgrp：修改文件所属用户组

这个很简单直接用命令就好

```
chgrp [-R] [groupname] dirname/filename
```

**这个-R主要意思是让子目录下所有的文件，目录都更新为用户组，这个很重要，有时候不用会报错的**

#### chown：修改文件的所有者

```
chown [-R] [name] file
```

-R是一个意思

#### chmod：修改文件权限

- 数字类型文件权限修改

  - 所谓数字类型文件修改是指，我们分别把拥有着、群组、其他人分开来其中分别对应权限

  - ```
    r:4
    w:2
    x:1
    ```

  - 所以比如rwxr-xr--对应就是754，所以你使用chmod -R 754 filename

  - -R一个意思

- 符号类型修改文件权限
  - 用u,g,o分别代表user,group,other这三个，然后a代表所有，就可以类似于输入参数进行文件权限的修改了
  - +，-，=分别代表添加，移除和设置
  - 比如我们要设置group多加一个w权限我们可以chmod -R g+w filename这样，移除也是如此
  - 如果我们要设置u,g两个就ug=rwx，然后都设置就用,隔开，ug=rwx,o=r这样就好了，非常方便

### Linux文件种类

#### 常规文件

这是最常见的文件，开头是-，有可以区分为

- 纯文本文件(ASCII):常用文件
- 二进制文件
- 数据文件

#### 目录

d开头的，不多说

#### 链接文件

类似于我们在Windows系统下面创建的快捷方式，第一个属性为|

#### 设备与设备文件

与系统周边及存储等相关的一些文件，通常在/dev这个目录下，又分为两种:

- 区块（block）设备文件：一般就是一些存储数据，以提供系统随机存取的接口设备，第一个属性就是b
- 字符（character）设备文件：是一些串行端口的接口设备，例如键盘、鼠标这类，第一个属性是c

#### 数据接口文件（sockets）

这个是用来在网络上数据交换的，这个要一定专业知识，网络编程的人来写

#### 数据输送文件（FIFO）

### Linux文件扩展名

**Linux的扩展名本质上是没有的，只要又权限，就可以执行这个东西，无论什么扩展名**，但是为了区分，我们通常还是会加一些.啥的，方便区分

- .sh：脚本文件
- z,.tar,.tar.gz,.zip,.tgz是雅座报
- .html,.php这种网页的

## Linux的目录配置

一般Linux都会按照FHS来进行目录配置，这样才可以更好管理东西

- /：根目录，和系统启动有关
- /usr：这个与软件安装/执行有关
- /var：这个与系统运行过程有关

# Linux文件和目录管理

## 目录与路径

### 相对路径和绝对路径

不多讲了，都知道，但是要注意**shell脚本的时候，多用绝对路径，不然容易出错**

### 常用的目录命令

#### cd(change directory):切换目录

不提常用，太常用了

#### pwd [-p]（print working directory）（显示目前所在的目录）

至于这个-p主要就是要知道绝对路径，而不是链接路径

#### mkdir(创建目录的)

```
mkdir [-mp]

-m:设置文件权限的，默认是unmask
-p:类似于前面的-R,创建一系列目录要用
```

#### rmdir：删除“空”目录

```
rmdir [-p]
```

### 关于执行文件路径的变量：$PATH

就是所谓环境变量的问题，可以使用以下命令寻找环境变量，**注意大小写敏感啊**

```
echo $PATH	
```

## 文件与目录管理

### 文件与目录的查看:ls

不常用的不说直接说常用的

```
ls [-adl]
```

- -a：全部的文件，包括隐藏文件
- -d：仅仅列出目录本身，而不列出目录内文件的内容
- -l：详细信息显示，包括权限

### 复制、删除与移动

#### cp(复制文件或目录)

```
cp [-aipru]  source destination
```

- -a：就是复制所有，包括权限
- -i：若目标文案已经存在时候，在覆盖时候会先询问操作
- -p：文件的属性（权限、用户、时间）一起复制，而不是使用默认属性
- -r：递归复制

**在默认的条件下，cp的源文件和目标文件的权限是不同的，目标文件权限一般都会变，拥有者会变成命令者本身，不想变就加-a吧**

#### rm(删除文件或者目录)

```
rm [-fir] file
```

- -f：忽略不存在的文件，不会出现警告信息
- -i：交互模式，在删除前询问使用者是否操作
- -r：递归删除，最常用于目录的删除，非常危险哦

#### mv(移动文件与目录，或重命名)

```
mv [-fiu] source destination
```

- -f：force不解释
- -i：删除前询问
- -u：目标文件已经存在，且source比较新，才会更新

还有就是重命名

```
mv test1 test2	#这样就重命名了
```

### 获取路径的文件名和目录名称

非常简单

```
basename /etc/sysconfig/network
===
network #显示文件名
====

dirname /etc/sysconfig/network

====
/etc/sysconfig	#显示目录名称
```

## 文件内容的查看

这个就比较重要了，也是用的比较多的东西，都要记一记，用一用

### 直接查看文件的内容

#### cat(concatenate)

```
cat [-n] file
```

-n就是显示行号显示既可以了

#### tac

这个就是cat倒过来写，从后往前看，但是最后一行变成第一行，倒数第二行变成第二行，没啥用啊

#### more

这个比较重要，翻页查看，一页一页反动

- 空格：翻下一页
- enter：下一行
- /字符串：就是查找字符
- :f：立刻显示文件名以及当前行数
- q:离开
- b：回翻页

#### less

这个也比较重要，可以向下和向上查找

- ?字符串：向上查找

#### head

```
head [-n number] file
```

这个是显示前几行多少行，即使python哪个

#### tail

```
tail [-n number] file
```

这个显示最后几行，也是python那个

### 非纯文本文件

#### od

```
od [-t Type] file
```

这个type里面就是用什么编码的意思，ASCII码，二进制，八进制，这些

## 文件与目录的默认权限与隐藏权限

### 文件默认权限：umask

如果新创建一个文件，新的权限就是按照umask来的

- 如果没有可执行权限，则最大为666

  ```
  -rw-rw-rw-
  ```

- 如果是目录，默认为777

但是啊umask的数字是指默认要减掉的权限，所以022说明就是user没有被减掉任何，22分别表示群组和其他减去了写，有时候小组作业，创建文件，需要小组成员进行更改的，所以不能是022，要002，使用如下命令

```
umask 002
```

### 文件的隐藏属性

#### chattr：设置隐藏属性

文件的隐藏属性主要是在系统的安全上面来考虑的，使用chattr来进行配置文件的隐藏属性

```
chattr [+-=] [ai] file
```

这里的+,-,=就是分别加上，减去，设置特定的隐藏属性

- a：当设置a之后，只能加数据，不能改，不能删除，不能其他事情

- i：这个就厉害，这个是保护一个文件的，任何东西都不能动，连root都不行，除非另外设置把他减掉

#### lsattr：列出隐藏属性

### 文件特殊权限：SUID,SGID,SBIT

这三个权限的意义是通过执行这个文件，来获得相应的权限，分别是对应root,group，最后的SBIT有点特殊就是对于目录加的

#### SUID

这个是对于所有者权限的x，会被替换成s，说明是SUID，当组群和其他人拥有执行权限，去执行这个文件的时候，**可以暂时获得所有者的权限，而且是仅仅针对这个文件程序具有owner权限**

****

但是有条件的：

- SUID权限仅仅针对二进制程序有效
- 执行者必须要x权限
- 仅仅在执行过程中获得权限

#### SGID

这个是让能执行的用户获得群组的权限**，仅仅是在执行程序中获得**

#### SBIT

这个是对于目录设置的，如果一个人，对这个目录有w和x权限，那他可以删除目录下不属于自己的文件，但是有SBIT，那他只能改自己的文件。

#### 权限的设置

在三栏前面加上一个数字就好

- 4为SUID
- 2为SGID
- 1为SBIT

比如4755，说明有SUID

### 观察文件的类型：file

```
file filename
```

这个可以查看文件编码格式啥的

## 命令与文件查找

### 脚本文件查找

**这个是用来查找再环境变量中的执行文件的文件名，默认只返回第一个**，如果加上-a选项，就可以查找所有同名文件，不仅仅显示第一个。

```
which [-a] command
```

### 文件的查找

#### whereis(由一些特定的目录中寻找文件)

```bash
whereis [-bmsu]  file
```

- -l：可以列出whereis会去查询的几个主要目录
- -b：只找二进制格式文件
- -m：只找再说明文件manual路径下的文件
- -s：只找source源文件
- -u：除以上文件的其他文件

#### locate/updatedb

```
locate [-ir] keyword
```

- -i：忽略大小写差异
- -c：不输出文件名，仅计算找到的文件数量
- -l：仅输出几行
- -S：输出locate所使用的数据库文件的相关信息
- -r：使用正则表达式进行查找

这个是去数据库里面查找，有时候要用updatedb来更新，然后查找才能出结果

#### find

这个比较好理解就是用来查找的

```
find [PATH] [option] [action]
```

- -mtime
  - -mtime n：意义为几天之前的某一天，被修改过内容的文件
  - -mtime +n：n天以前，被修改过文件内容
  - -mtime -n：n天以内被修改过的文件
  - -newer file：file是实际比较新的文件，这个就是列出比file新的文件
- -user name：这里name是指用户名字，查找文件夹下属于这个用户名字的东西
- -group name：类似这个是用户组的
- -nouser：查找文件的拥有着不在我们本机中
- -nogroup：查找文件所属组不再这个机中
- -name filename：查找文件名为filename的文件
- -size [+-] SIZE：查找大小大于，小于SIZE的文件，SIZE要加单位c表示字节，K就是KB

# Linux磁盘与文件系统管理

在以前一个分区只能被格式化成为一个文件系统，但是现在不一样了，现在一般定义为**一个可被挂载的数据为一个文件系统**

****

**文件系统的运行与操作系统的文件有关**，举个例子，一个文件会有很多属性，文件权限和文件属性。文件系统通常会把这两部分的数据分别存放在不同的区块，权限与属性放到inode中，实际数据就放在数据区块中。还有超级区块，会记录整个文件系统的整体信息。

****

- 超级区块：记录文件系统的整体信息，包括inode与数据区块的总量、使用量、剩余量，以及文件系统的格式与相关信息
- inode：记录文件的属性，一个文件占用**一个inode**，同时记录此文件的数据所在的区块号码
- 数据区块：实际记录文件的内容，文件太大，可能会占用多个区块

****

> ​	一般Linux读取文件就是，文件系统先格式化出inode与数据区块，通过Inode记录的区块去读取文件数据的区块，这种数据存取方法就是**索引式文件系统**
>
> ​	但是U盘不一样，U盘一般都是用FAT格式，这种没有inode这种东西，必须按照写入顺序，一个一个读，找到文件。
>
> ​	所以有时候我们听说碎片整理，就是因为文件写入的区块太过离散，此时文件读取的性能会变差，通过碎片整理将同一个文件的区块集合在一起，这样读取数据容易

### Linux的ext2文件系统（inode）

> ​	文件系统一开始就将inode与数据区块规划好了，除非重新格式化，否则inode与数据区块固定后就不再变动
>
> ​	文件系统的最前面都有一个启动扇区，启动扇区可以安装启动引导程序
>
> ​	一般情况下，ext2文件系统格式化时候基本上会区分很多区块组，里面再又许多东西，数据区块，节点，都是再这下面的

#### 数据区块

ext2文件系统中所支持的区块大小又1K,2K,4K这三种，但是不同的区块所支持的磁盘最大容量和单一文件最大量有所不同。

- 原则上，区块的大小与数量在格式化完成后就不能修改
- 每个区块内最多只能够放置一个文件的数据
- 如果文件大小大于区块，会被放到多个区块
- 如果文件很小，一个区块占不满，就会空着

#### inode table

这个就是inode这个东西，inode的数据有一些我列举一下:

- 每个文件都仅仅占用一个inode
- 一个inode仅仅有128B，一条就要4B所以会采用间接记录，具体看书

#### Superblock

超级区块储存的信息自己看看书

#### 区块对照表

#### inode对照表

### 与目录树的关系

#### 目录

文件系统会分配一个inode与至少一个区块给目录，这样inode记录目录的权限，属性什么的，然后区块记录目录下文件名与文件名占用inode号码数据，使用ls -i是可以看到所用区块的inode号码

#### 文件

#### 目录树读取

目录树是从根目录开始读取，因此系统通过挂载的信息可以找到挂载点的inode号码来一层一层读取

### ext2/ext3/ext4文件的存取与日志式文件系统的功能

当我们新增一个文件时候需要做的：

- 确定用户对于新增文件的目录是否有权限
- 根据inode对照表，找到空的
- 根据区块对照表找到空的
- 写入

### 挂载点的意义

- 挂载是指文件系统与目录树结合的操作
- **挂载点一定是目录，这个目录是文件系统的入口**

## 文件系统的简单操作

### 磁盘与目录的容量

#### df

这个可以显示文件系统整体的磁盘使用量

```
df [-hi] [目录或者文件]
```

默认情况下，会显示使用整体情况

- -h：用容易阅读的方式显示
- -i：不用磁盘容量，用inode的数量来表示

#### du

du这个命令和df不一样再会直接到文件系统查找所有文件数据，df一般都只是读取超级区块里信息

```
du [-hsSkm] file|dir
```

这里一定要加目录或者文件，因为他会查找的

- -h：用人民比较容易读的方式展示
- -m：用MB为单位
- -s：仅列出总量，而不列出每个目录占用容量

### 硬链接与符号链接：ln

#### 硬链接

> 硬链接我理解为，多个文件会链接到同一个inode号码，这就是硬链接，我两个文件都指向一个inode号码就可以了，读取的区块是一模一样的，这样更加安全。

```
ll -i  file #这个可以看到文件是否有硬链接
```

硬链接是有限制的：

- 不能跨文件系统
- 不能链接目录

#### 符号链接

符号链接是链接到文件名，不是链接到inode所以，源文件没了，就无法执行了

#### ln

``` 
ln [-s] sourcefile file
```

- -s：使用这个是创建符号链接，默认是硬链接

**在创建新目录的时候，新目录链接数会增加2，上层目录增加1，都是硬链接**

## 磁盘的分区、格式化、检验与挂载

### 观察磁盘分区

#### lsblk

> 这个可以列出系统上所有磁盘列表

- MAJ:MIN：
- RM：是否为可卸载设备
- SIZE：容量
- RO：是否是只读设备
- TYPE：是磁盘（disk），分区（part），还是只读存储器（ROM）
- MOUNTPOINT：挂载点

#### blkid

> ​	这个可以列出设备的UUID等参数

UUID：全局唯一标识符，Linux会给系统内所有设备一个独一无二的标识符，可以拿来作为挂载或是这个设备或文件系统

#### parted

> ​	列出磁盘的分区表类型与分区信息

### 磁盘分区：gdisk/fdisk

**MBR分区使用fdisk分区，GPT分区使用gdisk分区。**

# 文件和文件系统的压缩

## Linux常用的压缩命令

### gzip

- 压缩：

```
gzip [-cdtv#] 文件名
```

-c：将压缩的数据输出到屏幕上

-d：解压参数

- 解压缩

```
zcat 文件
```

**注意：这里压缩后，源文件会被删掉**

#### xz

- 压缩：

```
xz [-dtlkc#] 文件名
```

-d：就是解压缩

-l：列出压缩文件信息

-k：保留原本文件不删除

- 解压

```
xcat 文件名
```

#### tar

**如果是打包，一定要用这个，前面的仅仅能够对一个文件进行压缩，这个可以对目录一堆文件夹进行压缩**

主要就是下面几个，其他不用也记不住

- 压缩：

  - ```
    tar -jcv -f filename.tar.bz2 要被压缩的文件或目录名称
    ```

- 查询：

  - ```
    tar -jtv -f filename.tar.bz2
    ```

- 解压缩

  - ```
    tar -jxv -f filename.tar.bz2 -C 要解压到的目录
    ```

    